import unittest
import importlib.resources
from closestexposures import closest_exposures
import numpy as np
from astropy.table import Table

class TestClosestExposures(unittest.TestCase):
    def setUp(self):
        yeardic={'NIGHT':[
                        20250102,
                        20250102,
                        20250103,
                        20250101,
                        20250101,
                        20250103,
                        20250103,
                        20250103,
                        20241231,
                        20241231,
                        20250104,
                        20250104,
                        20241230,
                        20241230,
                        20250105,
                        20250105,
                        20250106,
                        20241229,
                        20241229,
                        20250106],
                  'EXPID':[271458,
                        271459,
                        271580,
                        271318,
                        271317,
                        271607,
                        271646,
                        271647,
                        271171,
                        271170,
                        271785,
                        271786,
                        271030,
                        271029,
                        271929,
                        271930,
                        272040,
                        270887,
                        270886,
                        272067
            
                  ],
                'MJD':[
                        60678.589764149,
                        60678.604946538,
                        60679.356921706,
                        60677.608038944,
                        60677.592856272,
                        60679.459449861,
                        60679.592815239,
                        60679.607997638,
                        60676.604650642,
                        60676.589463439,
                        60680.593557882,
                        60680.608734221,
                        60675.603671047,
                        60675.58848343,
                        60681.591850445,
                        60681.607037709,
                        60682.303591992,
                        60674.60563026,
                        60674.59045293,
                        60682.438530698
                    
                ],
                'OBSTYPE':[
                      'dark',
                      'dark',
                      'dark',
                      'dark',
                      'dark',
                      'dark',
                      'dark',
                      'dark',
                      'dark',
                      'dark',
                      'dark',
                      'dark',
                      'dark',
                      'dark',
                      'dark',
                      'dark',
                      'dark',
                      'dark',
                      'dark',
                      'dark'
                ],
                'EXPTIME':[
                1200.0333,
                1200.0459,
                1200.0578,
                1200.0519,
                1200.0481,
                1200.0466,
                1200.0311,
                1200.0409,
                1200.0489,
                 1200.042,
                1200.0502,
                1200.0305,
                1200.0555,
                1200.0429,
                1200.0504,
                1200.0383,
                1200.0364,
                1200.0386,
                1200.0428,
                1200.0457
                ]
        }
        monthdic={
            'NIGHT':[
                20250602,
                20250602,
                20250602,
                20250602,
                20250602,
                20250603,
                20250603,
                20250604,
                20250604,
                20250531,
                20250531,
                20250530,
                20250530,
                20250605,
                20250605,
                20250529,
                20250606,
                20250529,
                20250606,
                20250528
            ],
            'EXPID':[
                296653,
                296654,
                296614,
                296596,
                296574,
                296775,
                296776,
                296991,
                296992,
                296406,
                296405,
                296267,
                296266,
                297151,
                297152,
                296115,
                297309,
                296114,
                297310,
                295961
            ],
            'MJD':[
                60829.501328249,
                 60829.51661492,
                60829.308120871,
                60829.243447908,
                60829.162415303,
                60830.502094769,
                60830.517385213,
                60831.500822863,
                60831.516113663,
                60827.325326484,
                60827.310036721,
                60826.523819739,
                60826.508524839,
                 60832.50266611,
                60832.517960559,
                60825.513235829,
                60833.501495368,
                60825.497941476,
                60833.516785193,
                60824.519952839
            ],
            'OBSTYPE':[
               'dark',
               'dark',
               'dark',
               'dark',
               'dark',
               'dark',
               'dark',
               'dark',
               'dark',
               'dark',
               'dark',
               'dark',
               'dark',
               'dark',
               'dark',
               'dark',
               'dark',
               'dark',
               'dark',
               'dark'
            ],
            'EXPTIME':[
                1200.0484,
                1200.0428,
                1200.0574,
                1200.0667,
                1200.0511,
                1200.0498,
                1200.0494,
                1200.0488,
                1200.0696,
                1200.0499,
                1200.0466,
                1200.0583,
                1200.0455,
                1200.0601,
                1200.0428,
                1200.0425,
                1200.0481,
                1200.0475,
                1200.0449,
                1200.0484
            ]
        }
        self.month=Table(monthdic)
        self.year=Table(yeardic)
    def test_closest_exposure_function_month(self):
        # month
        monthtest=closest_exposures(self.month,20250602,10)
        self.assertTrue(20250531 in monthtest['NIGHT'])
    def test_closest_exposure_function_year(self):
        # year
        yeartest=closest_exposures(self.year,20250102,10)
        self.assertTrue(20241231 in yeartest['NIGHT'])